

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Adding Custom Controls &mdash; 3DB  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using a Custom Inference Model" href="custom_inference.html" />
    <link rel="prev" title="Customizing 3DB" href="customizing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 3DB
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting started with 3DB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#run-a-simple-experiment">Run a simple experiment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#running-the-master-node">Running the master node</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#running-the-clients">Running the clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#running-the-dashboard">Running the dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#analyzing-the-results">Analyzing the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing_config_file.html">Writing a configuration file</a><ul>
<li class="toctree-l2"><a class="reference internal" href="writing_config_file.html#inference-settings">Inference settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_config_file.html#evaluation-settings">Evaluation settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_config_file.html#rendering-settings">Rendering settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_config_file.html#controls-settings">Controls settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_config_file.html#policy-settings">Policy settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_config_file.html#logging-settings">Logging settings</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="customizing.html">Customizing 3DB</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="customizing.html#the-3db-workflow">The 3DB Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="customizing.html#step-1-scheduler-prioritizes-a-job-server-sends-to-client">Step 1: Scheduler prioritizes a job, server sends to client</a></li>
<li class="toctree-l3"><a class="reference internal" href="customizing.html#step-2-client-renders-and-applies-controls">Step 2: Client renders and applies controls</a></li>
<li class="toctree-l3"><a class="reference internal" href="customizing.html#step-3-client-predicts-and-evaluates">Step 3: Client predicts and evaluates</a></li>
<li class="toctree-l3"><a class="reference internal" href="customizing.html#step-4-results-sent-back-to-server">Step 4: Results sent back to server</a></li>
<li class="toctree-l3"><a class="reference internal" href="customizing.html#customization">Customization</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="customizing.html#customization-guides">Customization Guides</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Adding Custom Controls</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preprocesscontrol">PreProcessControl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#postprocesscontrol">PostProcessControl</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="custom_inference.html">Using a Custom Inference Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="custom_inference.html#implementation">Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom_inference.html#updating-the-configuration-file">Updating the configuration file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="custom_evaluator.html">Using a Custom Evaluator (for custom tasks)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="custom_evaluator.html#implementation">Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom_evaluator.html#updating-the-configuration-file">Updating the configuration file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="custom_logger.html">Creating a Custom Logger</a><ul>
<li class="toctree-l4"><a class="reference internal" href="custom_logger.html#implementation">Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="custom_logger.html#updating-the-configuration-file">Updating the configuration file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="custom_renderer.html">Customizing Rendering</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.controls.html">threedb.controls package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.controls.blender.html">threedb.controls.blender package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.background.html">threedb.controls.blender.background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.camera.html">threedb.controls.blender.camera</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.denoiser.html">threedb.controls.blender.denoiser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.imagenet_c.html">threedb.controls.blender.imagenet_c</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.material.html">threedb.controls.blender.material</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.mug_liquid.html">threedb.controls.blender.mug_liquid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.obj_loc_in_frame.html">threedb.controls.blender.obj_loc_in_frame</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.occlusion.html">threedb.controls.blender.occlusion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.orientation.html">threedb.controls.blender.orientation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.pin_to_ground.html">threedb.controls.blender.pin_to_ground</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.pointlight.html">threedb.controls.blender.pointlight</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.position.html">threedb.controls.blender.position</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.scale.html">threedb.controls.blender.scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/threedb.controls.blender.utils.html">Rendering utils</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.controls.base_control.html">threedb.controls.base_control</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.evaluators.html">threedb.evaluators package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.evaluators.base_evaluator.html">threedb.evaluators.base_evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.evaluators.classification.html">threedb.evaluators.classification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.policies.html">threedb.policies package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.policies.grid_search.html">threedb.policies.grid_search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.policies.random_search.html">threedb.policies.random_search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.rendering.html">threedb.rendering package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.rendering.base_renderer.html">threedb.rendering.base_renderer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.rendering.render_blender.html">threedb.rendering.render_blender</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.rendering.utils.html">Rendering Utils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.result_logging.html">threedb.result_logging package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.result_logging.base_logger.html">threedb.result_logging.base_logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.result_logging.image_logger.html">threedb.result_logging.image_logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.result_logging.json_logger.html">threedb.result_logging.json_logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.result_logging.logger_manager.html">threedb.result_logging.logger_manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.result_logging.tb_logger.html">threedb.result_logging.tb_logger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.scheduling.html">threedb.scheduling package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.scheduling.base_scheduler.html">threedb.scheduling.base_scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.scheduling.policy_controller.html">threedb.scheduling.policy_controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.scheduling.search_space.html">threedb.scheduling.search_space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/threedb.scheduling.utils.html">Scheduling utils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.client.html">threedb.client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.main.html">threedb.main</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/threedb.utils.html">threedb.utils</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">3DB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="customizing.html">Customizing 3DB</a> &raquo;</li>
        
      <li>Adding Custom Controls</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/usage/custom_controls.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-custom-controls">
<h1>Adding Custom Controls<a class="headerlink" href="#adding-custom-controls" title="Permalink to this headline">¶</a></h1>
<p>By default, 3DB comes with a number of <cite>controls</cite> that allows the user to
manipulate the simulated scene.</p>
<p>We will now go through the steps for implementing a custom control module. To make things
clearer, we’ll actually re-implement:</p>
<ul class="simple">
<li><p>A “preprocessing” control, <code class="docutils literal notranslate"><span class="pre">OrientationControl</span></code>, that controls the main
object’s location in the scene.</p></li>
<li><p>A “postprocessing” control, <code class="docutils literal notranslate"><span class="pre">CorruptionControl</span></code>, that adds corruptions
to the rendered scenes.</p></li>
</ul>
<div class="section" id="preprocesscontrol">
<h2>PreProcessControl<a class="headerlink" href="#preprocesscontrol" title="Permalink to this headline">¶</a></h2>
<p>These type of controls are implemented to change/control the scene before an
image of the scene is rendered, e.g., move objects around, add occlusion,
change camera properties, change the scale of the object, etc. All it takes to
implement a new preprocess control is to subclass the provided base class,
<a class="reference internal" href="../api/threedb.controls.base_control.html#threedb.controls.base_control.PreProcessControl" title="threedb.controls.base_control.PreProcessControl"><code class="xref py py-class docutils literal notranslate"><span class="pre">threedb.controls.base_control.PreProcessControl</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threedb.controls.base_control</span> <span class="kn">import</span> <span class="n">PreProcessControl</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">OrientationControl</span><span class="p">(</span><span class="n">PreProcessControl</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>In order to make this a valid preprocessing control, we need to provide implementations of two
abstract functions: <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, and <code class="docutils literal notranslate"><span class="pre">apply</span></code>. It can sometimes help to (optionally) implement
the <code class="docutils literal notranslate"><span class="pre">unapply</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is the place to define the arguments needed by the control:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">continuous_dims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rotation_x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="s1">&#39;rotation_y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="s1">&#39;rotation_z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="n">continuous_dims</span><span class="o">=</span><span class="n">continuous_dims</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we need to implement the <code class="docutils literal notranslate"><span class="pre">apply()</span></code> function, which is called whenever a control is to be applied to the scene:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">control_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Rotates the object according to the given parameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    context : Dict[str, Any]</span>
<span class="sd">        The scene context object</span>
<span class="sd">    control_args : Dict[str, Any]</span>
<span class="sd">        The parameters for this control, ``rotation_x``, ``rotation_y``, and</span>
<span class="sd">        ``rotation_z``. See the class docstring for their documentation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_err</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_arguments</span><span class="p">(</span><span class="n">control_args</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">no_err</span><span class="p">,</span> <span class="n">msg</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">rotation_mode</span> <span class="o">=</span> <span class="s1">&#39;XYZ&#39;</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">rotation_euler</span> <span class="o">=</span> <span class="p">(</span><span class="n">control_args</span><span class="p">[</span><span class="s1">&#39;rotation_x&#39;</span><span class="p">],</span>
                          <span class="n">control_args</span><span class="p">[</span><span class="s1">&#39;rotation_y&#39;</span><span class="p">],</span>
                          <span class="n">control_args</span><span class="p">[</span><span class="s1">&#39;rotation_z&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Finally, assign the name of the control to a variable <code class="docutils literal notranslate"><span class="pre">Control</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Control</span> <span class="o">=</span> <span class="n">OrientationControl</span>
</pre></div>
</div>
<p>Note that for some controls, the user might also need to implement an <code class="docutils literal notranslate"><span class="pre">unapply()</span></code> function, which reverses the effects of the control after an image is rendered.
After this function is called, the scene is reset for subsequent renders and controls applications.
See <a class="reference internal" href="../api/threedb.controls.blender.position.html#threedb.controls.blender.position.PositionControl" title="threedb.controls.blender.position.PositionControl"><code class="xref py py-class docutils literal notranslate"><span class="pre">threedb.controls.blender.position.PositionControl</span></code></a> for an example.
In the case of <code class="docutils literal notranslate"><span class="pre">PositionControl</span></code>, the <code class="docutils literal notranslate"><span class="pre">apply</span></code> function translates the position by a specific vector.
Thus, implementing <code class="docutils literal notranslate"><span class="pre">unapply</span></code> ensures that all calls to <code class="docutils literal notranslate"><span class="pre">apply</span></code> begin from the same original position.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>How do we know what code to write in <code class="docutils literal notranslate"><span class="pre">apply</span></code> (and <code class="docutils literal notranslate"><span class="pre">unapply</span></code>)?</p>
<p>To find out, you will first need to download Blender and modify the object’s <cite>.blend</cite> file yourself in Blender.
Then, the corresponding line of code will appear in the <strong>Scripting</strong> tab.</p>
<p>Here, we include step-by-step pictures showing how to find the code for <code class="docutils literal notranslate"><span class="pre">OrientationControl</span></code>, using the <cite>025_mug.blend</cite> file from the <a class="reference external" href="https://github.com/3db/blog_demo">https://github.com/3db/blog_demo</a> repo and Blender version 2.92.0.</p>
<ol class="arabic simple">
<li><p>First, open Blender.</p></li>
</ol>
<a class=""
               data-lightbox="group-blender_controls"
               href="../_images/blender_controls_11.png"
               title=""
               data-title=""
               ><img src="../_images/blender_controls_11.png"
                     class=""
                     width="700"
                     height="auto"
                     alt=""/>
                </a><p>2. Click on <strong>File</strong> &gt;&gt; <strong>Open</strong> and select <cite>025_mug.blend</cite>.
You can optionally zoom in and click on “Viewport Shading” in the upper right corner to make the mug look like it does in the picture below.</p>
<a class=""
               data-lightbox="group-blender_controls"
               href="../_images/blender_controls_21.png"
               title=""
               data-title=""
               ><img src="../_images/blender_controls_21.png"
                     class=""
                     width="700"
                     height="auto"
                     alt=""/>
                </a><ol class="arabic simple" start="3">
<li><p>Select the mug object, then select <strong>Object Properties</strong> in the middle right sidebar.</p></li>
</ol>
<a class=""
               data-lightbox="group-blender_controls"
               href="../_images/blender_controls_31.png"
               title=""
               data-title=""
               ><img src="../_images/blender_controls_31.png"
                     class=""
                     width="700"
                     height="auto"
                     alt=""/>
                </a><ol class="arabic simple" start="4">
<li><p>Change the <strong>Mode</strong> to <cite>XYZ Euler</cite>, and update the <strong>Rotation X, Y, Z</strong> values to <cite>180</cite>, <cite>90</cite>, and <cite>45</cite>, respectively.</p></li>
</ol>
<a class=""
               data-lightbox="group-blender_controls"
               href="../_images/blender_controls_41.png"
               title=""
               data-title=""
               ><img src="../_images/blender_controls_41.png"
                     class=""
                     width="700"
                     height="auto"
                     alt=""/>
                </a><p>5. Finally, click on the <strong>Scripting</strong> tab in the upper right. The code you need to write will appear in the bottom left panel!
(The variable <code class="docutils literal notranslate"><span class="pre">bpy.context.object</span></code> in the panel corresponds to <code class="docutils literal notranslate"><span class="pre">context['object']</span></code> in the code for <code class="docutils literal notranslate"><span class="pre">OrientationControl</span></code>)</p>
<a class=""
               data-lightbox="group-blender_controls"
               href="../_images/blender_controls_51.png"
               title=""
               data-title=""
               ><img src="../_images/blender_controls_51.png"
                     class=""
                     width="700"
                     height="auto"
                     alt=""/>
                </a></div>
</div>
<div class="section" id="postprocesscontrol">
<h2>PostProcessControl<a class="headerlink" href="#postprocesscontrol" title="Permalink to this headline">¶</a></h2>
<p>These type of controls are implemented to modify the rendered image, e.g., add image-level corruptions, change background color, etc.
All it takes to implement a new postprocess control is to subclass the provided base class,
<a class="reference internal" href="../api/threedb.controls.base_control.html#threedb.controls.base_control.PostProcessControl" title="threedb.controls.base_control.PostProcessControl"><code class="xref py py-class docutils literal notranslate"><span class="pre">threedb.controls.base_control.PostProcessControl</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threedb.controls.base_control</span> <span class="kn">import</span> <span class="n">PostProcessControl</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="k">class</span> <span class="nc">CorruptionControl</span><span class="p">(</span><span class="n">PostProcessControl</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>In order to make this a valid postprocessing control, we need to provide implementations of two
abstract functions: <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, and <code class="docutils literal notranslate"><span class="pre">apply</span></code>.</p>
<p>Similar to before, the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is the place to define the arguements needed by the control:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">discrete_dims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s1">&#39;corruption_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gaussian_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;impulse_noise&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;defocus_blur&#39;</span><span class="p">,</span> <span class="s1">&#39;glass_blur&#39;</span><span class="p">,</span> <span class="s1">&#39;motion_blur&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;zoom_blur&#39;</span><span class="p">,</span> <span class="s1">&#39;snow&#39;</span><span class="p">,</span> <span class="s1">&#39;frost&#39;</span><span class="p">,</span> <span class="s1">&#39;fog&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;speckle_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;gaussian_blur&#39;</span><span class="p">,</span> <span class="s1">&#39;spatter&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;saturate&#39;</span><span class="p">,</span> <span class="s1">&#39;brightness&#39;</span><span class="p">,</span> <span class="s1">&#39;contrast&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;elastic_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;pixelate&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;jpeg_compression&#39;</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span>
                     <span class="n">discrete_dims</span><span class="o">=</span><span class="n">discrete_dims</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we need to implement the <code class="docutils literal notranslate"><span class="pre">apply()</span></code> function, which is called whenever a control is to be applied to the scene:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render</span><span class="p">:</span> <span class="n">ch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">control_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Apply an Imagenet-C corruption on the rendered image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    render : ch.Tensor</span>
<span class="sd">        Image to transform.</span>
<span class="sd">    control_args : Dict[str, Any]</span>
<span class="sd">        Corruption parameterization, must have keys ``corruption_name`` and</span>
<span class="sd">        ``severity`` (see class documentation for information about the</span>
<span class="sd">        control arguments).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ch.Tensor</span>
<span class="sd">        The transformed image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_arguments</span><span class="p">(</span><span class="n">control_args</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">args_check</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args_check</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sev</span><span class="p">,</span> <span class="n">c_name</span> <span class="o">=</span> <span class="n">control_args</span><span class="p">[</span><span class="s1">&#39;severity&#39;</span><span class="p">],</span> <span class="n">control_args</span><span class="p">[</span><span class="s1">&#39;corruption_name&#39;</span><span class="p">]</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">render</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="p">(</span><span class="n">img</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">corrupt</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="n">sev</span><span class="p">,</span> <span class="n">corruption_name</span><span class="o">=</span><span class="n">c_name</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="k">return</span> <span class="n">ch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, assign the name of the control to a variable <code class="docutils literal notranslate"><span class="pre">Control</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Control</span> <span class="o">=</span> <span class="n">CorruptionControl</span>
</pre></div>
</div>
<p>Note that for postprocess controls, we don’t need the <code class="docutils literal notranslate"><span class="pre">unapply()</span></code> method, since all the changes are done at the image
level, and the actual simulation scene is not altered.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="custom_inference.html" class="btn btn-neutral float-right" title="Using a Custom Inference Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="customizing.html" class="btn btn-neutral float-left" title="Customizing 3DB" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, 3DB Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>